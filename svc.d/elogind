#!/bin/sh
. /etc/leaninit.d/rc.svc

# elogind
NAME="elogind"
DAEMON=elogind-daemon

main() {
	dbus_req
	if [ "$(command -v elogind)" = "" ] && [ ! -x /usr/libexec/elogind/elogind ]; then
		print "Could not start elogind..." ${RED} ${LIGHT_RED}
		return 1
	else
		[ -x /usr/libexec/elogind/elogind ] && /usr/libexec/elogind/elogind &
		[ "$(command -v elogind)" != "" ] && elogind &
	fi
	until [ "$(pgrep -x elogind-daemon)" != "" ]; do
		sleep 1
		break
	done
	if [ -x /usr/libexec/elogind/elogind-uaccess-command ]; then
		/usr/libexec/elogind/elogind-uaccess-command /dev
		for fs in $(df -t tmpfs | tail -n +2 | awk '{print $6}'); do
			/usr/libexec/elogind/elogind-uaccess-command $fs
		done
	fi
}

run elogind $1 $2
